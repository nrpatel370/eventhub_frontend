<!-- src/app/components/event-detail/event-detail.component.html -->
<div class="event-detail-container" *ngIf="!loading && event">
  
  <!-- Event Header -->
  <mat-card class="event-header-card">
    <div class="event-header-content" id="event-detail-header">
      <div class="event-title-section">
        <h1>{{ event.title }}</h1>
        <mat-chip-set>
          <mat-chip>{{ event.category }}</mat-chip>
        </mat-chip-set>
      </div>
      
      <div class="event-actions" *ngIf="isOrganizer() || authService.isAdmin">
        <button mat-icon-button [matMenuTriggerFor]="menu">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="editEvent()" *ngIf="isOrganizer()">
            <mat-icon>edit</mat-icon>
            <span>Edit Event</span>
          </button>
          <button mat-menu-item (click)="deleteEvent()">
            <mat-icon>delete</mat-icon>
            <span>Delete Event</span>
          </button>
        </mat-menu>
      </div>
    </div>

    <mat-card-content>
      <div class="event-info-grid">
        <div class="info-item">
          <mat-icon>schedule</mat-icon>
          <div>
            <strong>Date & Time</strong>
            <p>{{ formatDate(event.eventDate) }}</p>
          </div>
        </div>

        <div class="info-item">
          <mat-icon>location_on</mat-icon>
          <div>
            <strong>Location</strong>
            <p>{{ event.location }}</p>
          </div>
        </div>

        <div class="info-item">
          <mat-icon>person</mat-icon>
          <div>
            <strong>Organized by</strong>
            <p>{{ event.organizer?.username }}</p>
          </div>
        </div>

        <div class="info-item" *ngIf="event.maxParticipants">
          <mat-icon>groups</mat-icon>
          <div>
            <strong>Capacity</strong>
            <p>{{ goingCount }} / {{ event.maxParticipants }}</p>
          </div>
        </div>
      </div>

      <div class="event-description">
        <h3>About this event</h3>
        <p>{{ event.description }}</p>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- RSVP Section -->
  <mat-card class="rsvp-card">
    <mat-card-header>
      <mat-card-title>RSVP</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="rsvp-stats">
        <div class="stat">
          <mat-icon>check_circle</mat-icon>
          <span><strong>{{ goingCount }}</strong> Going</span>
        </div>
        <div class="stat">
          <mat-icon>star</mat-icon>
          <span><strong>{{ interestedCount }}</strong> Interested</span>
        </div>
      </div>

      <div class="rsvp-buttons" *ngIf="authService.isAuthenticated">
        <button mat-raised-button 
                [color]="userRsvpStatus === RsvpStatus.GOING ? 'primary' : ''"
                (click)="rsvp(RsvpStatus.GOING)">
          <mat-icon>check_circle</mat-icon>
          Going
        </button>
        <button mat-raised-button 
                [color]="userRsvpStatus === RsvpStatus.INTERESTED ? 'accent' : ''"
                (click)="rsvp(RsvpStatus.INTERESTED)">
          <mat-icon>star</mat-icon>
          Interested
        </button>
        <button mat-stroked-button 
                *ngIf="userRsvpStatus"
                (click)="rsvp(RsvpStatus.NOT_GOING)">
          <mat-icon>cancel</mat-icon>
          Cancel RSVP
        </button>
      </div>

      <div class="login-prompt" *ngIf="!authService.isAuthenticated">
        <p>Please <a routerLink="/login">login</a> to RSVP to this event</p>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Participants -->
  <mat-card class="participants-card" *ngIf="participants.length > 0">
    <mat-card-header>
      <mat-card-title>Participants ({{ participants.length }})</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="participants-list">
        <div *ngFor="let rsvp of participants" class="participant-item">
          <mat-icon>person</mat-icon>
          <span>{{ rsvp.user.username }}</span>
          <mat-chip [color]="rsvp.status === 'GOING' ? 'primary' : 'accent'">
            {{ rsvp.status }}
          </mat-chip>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Comments Section -->
  <mat-card class="comments-card">
    <mat-card-header>
      <mat-card-title>Comments ({{ comments.length }})</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      
      <!-- Add Comment -->
      <div class="add-comment" *ngIf="authService.isAuthenticated">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Add a comment</mat-label>
          <textarea matInput 
                    [(ngModel)]="newComment"
                    rows="3"
                    placeholder="Share your thoughts...">
          </textarea>
        </mat-form-field>
        <button mat-raised-button 
                color="primary"
                (click)="addComment()"
                [disabled]="!newComment.trim()">
          Post Comment
        </button>
      </div>

      <div class="login-prompt" *ngIf="!authService.isAuthenticated">
        <p>Please <a routerLink="/login">login</a> to comment</p>
      </div>

      <!-- Comments List -->
      <div class="comments-list">
        <div *ngFor="let comment of comments" class="comment-item">
          <div class="comment-header">
            <div class="comment-author">
              <mat-icon>account_circle</mat-icon>
              <strong>{{ comment.user.username }}</strong>
              <span class="comment-date">
                {{ comment.createdAt | date:'short' }}
              </span>
            </div>
            <button mat-icon-button 
                    *ngIf="canDeleteComment(comment)"
                    (click)="deleteComment(comment.id!)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
          <p class="comment-content">{{ comment.content }}</p>
        </div>

        <div *ngIf="comments.length === 0" class="no-comments">
          <p>No comments yet. Be the first to comment!</p>
        </div>
      </div>

    </mat-card-content>
  </mat-card>

</div>

<div class="loading-spinner" *ngIf="loading">
  <mat-spinner></mat-spinner>
</div>
